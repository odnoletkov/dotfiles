#!/bin/bash
set -eu

git diff-index --quiet HEAD || (
	echo >&2 "error: dirty working tree or index"
	exit 1
)

target=${1?"specify target ref"}
base=$(git merge-base HEAD "$target")
git reset --soft "$base" --

git --no-pager diff --cached --stat
