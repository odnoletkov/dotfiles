#!/usr/bin/env bash

path="/Applications/Xcode.app/Contents/Developer/Applications/Simulator.app/Contents/MacOS/Simulator"
if [ ! -f $path ]; then
	echo "wrong simulator path"
	exit 1
fi

codesign -d "$path" 2> /dev/null

if [ $? -eq 0 ]
then
    echo "Simulator binary is code-signed. Trying to remove signature to disable SIP."
    codesign --remove-signature "$path" || exit 1
fi

lldb -n Simulator \
-o "expr ((NSWindow *)[(NSArray *)[[NSApplication sharedApplication] windows] setValue:@(1<<7|1<<8|1<<11) forKey:@\"collectionBehavior\"]);" \
-o "set set auto-confirm true" \
-o quit
